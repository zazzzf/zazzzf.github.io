---
title: å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
date: 2020-01-30
categories:
  - Vue
tags:
  - Vue
  - æ’ä»¶
  - å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
---

::: tip

æœ¬æ–‡ä»‹ç»äº†ä¸€æ¬¾å¯Œæ–‡æœ¬ç¼–è¾‘å™¨åœ¨vueä¸­ä½¿ç”¨åŠç¤ºä¾‹ã€‚

:::

<!-- more -->

## wangEditor <a href="http://www.wangeditor.com/">é¡¹ç›®åœ°å€</a>
åŸºäºjavascriptå’Œcsså¼€å‘çš„ Webå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œ è½»é‡ã€ç®€æ´ã€æ˜“ç”¨ã€å¼€æºå…è´¹

æ”¯æŒå¸¸ç”¨çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨åŠŸèƒ½ï¼Œå›¾ç‰‡ä¸Šä¼ ï¼Œç½‘ç»œåœ°å€å¼•å…¥ï¼Œå›¾ç‰‡å¤åˆ¶ï¼Œè§†é¢‘å¼•å…¥ç­‰ï¼Œå…·ä½“å¯è‡ªè¡ŒæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£å†åšé€‰æ‹©ã€‚

<img src="../../.vuepress/public/wangEditor.png" class="zoom-custom-imgs" />

 tip é™„ä¸Šä»£ç ï¼ˆvue + element-uiï¼‰ï¼š
 å®é™…å…³äºä¸Šä¼ è§†é¢‘çš„åœ°æ–¹éœ€æ±‚ä¸åŒ è¿™é‡Œåªæä¾›ä¸€ä¸ªè§£å†³æ–¹æ³•  å…·ä½“è¯·æ ¹æ®å®é™…ä½¿ç”¨ä¿®æ”¹

## ä»£ç 

```vue
<template>
	<div class="editor">
		<div class="header">
            <div id="div1" class="toolbar"></div>
            <!-- //è¿™é‡Œä½¿ç”¨elementçš„uploadç»„ä»¶ç”¨äºä¸Šä¼ æœ¬åœ°è§†é¢‘
			<el-upload
				class="upload-demo"
				action="ä½ çš„æœåŠ¡å™¨æ¥æ”¶åœ°å€"
				:limit="1"
				accept="video/*,.mp4"
				:data="uploadData"
                :disabled='uploadLoading'
                //è¿™é‡Œåªè®¾ç½®äº†å…è®¸ä¸Šä¼ ä¸€ä¸ªè§†é¢‘
				v-if='fileList.length == 0 && menus.indexOf("videos")!==-1'
				:show-file-list="false"
				:before-upload="handleBeforeUpload"
				:on-progress="onFileProgress"
				:on-success="handleSuccessUpload"
			>
				<el-button  size="small" type="primary">ä¸Šä¼ è§†é¢‘</el-button>
			</el-upload>
			<span v-if="uploadLoading">{{ uploadSpeed }}</span>
			<el-progress v-if="uploadLoading" :percentage="progressNum"></el-progress>
             -->
		</div>
		<div id="div2" class="text"></div>
		<div ref="editor" style="text-align:left;"></div>
	</div>
</template>

<script>
import E from 'wangeditor';
var editor;
import emojiArr from './emoji.js';
import { qiniuToken,uploadImg } from '@/api/token';

export default {
	props: {
		content: { type: String, default: '' },
		menus: {
			type: Array,
			default: () => {
				return [
					'head', // æ ‡é¢˜
					'bold', // ç²—ä½“
					'fontSize', // å­—å·
					'fontName', // å­—ä½“
					'italic', // æ–œä½“
					'underline', // ä¸‹åˆ’çº¿
					'strikeThrough', // åˆ é™¤çº¿
					'foreColor', // æ–‡å­—é¢œè‰²
					'backColor', // èƒŒæ™¯é¢œè‰²
					'link', // æ’å…¥é“¾æ¥
					'list', // åˆ—è¡¨
					'justify', // å¯¹é½æ–¹å¼
					'quote', // å¼•ç”¨
					'emoticon', // è¡¨æƒ…
					'image', // æ’å…¥å›¾ç‰‡
					'table', // è¡¨æ ¼
					'video', // æ’å…¥è§†é¢‘
					'code', // æ’å…¥ä»£ç 
					'undo', // æ’¤é”€
                    'redo', // é‡å¤
                    //"videos" é»˜è®¤ä¸å¼€å¯ éœ€è¦è¯·ä¼ å…¥å¹¶é…ç½®
				];
			}
		}
	},
	data() {
		return {
			currentValue: '',
			uploadSpeed: '0KB/s',
			uploadData:{
				token:'',key:''
			},
			fileList:[],
			progressNum:0,
			uploadLoading:false,
		};
	},
	methods: {
		createEditor() {
			var that = this;
			var qiniutoken = '';
			editor = new E('#div1', '#div2');
			editor.customConfig = {
				zIndex: 100,
				onchange: function(html) {
					that.currentValue = html;
					that.$emit('on-change', that.currentValue);
				},
				
				menus: that.menus,
				emotions: [
					{
						/*emoji */
						title: 'ğŸ˜€',
						type: 'emoji',
						content: emojiArr.Smileys
					},
					{
						//äººå’Œå¹»æƒ³
						title: 'ğŸ‘¶',
						type: 'emoji',
						content: emojiArr.PeopleAndFantasy
					},
					{
						//è¡£æœåŠé…é¥°
						title: 'ğŸ‘š',
						type: 'emoji',
						content: emojiArr.ClothingAndAccessories
					}
				],
				//---------é…ç½®ä¸Šä¼ å›¾ç‰‡---------
				uploadImgServer:"ä¸Šä¼ å›¾ç‰‡çš„æœåŠ¡å™¨åœ°å€",
				customUploadImg :function (files, insert) {
                    //è¿™é‡Œéœ€ä¸Šä¼ 
                    insert('ä¸Šä¼ å®Œæˆåè¿”å›çš„å›¾ç‰‡ç½‘ç»œåœ°å€') 
				}
            };
            //åˆ›å»ºç¼–è¾‘å™¨
			editor.create();
			if (this.content) {
				editor.txt.html(`<p>${this.content}</p>`);
			}
		},
		/**
		handleBeforeUpload(file) {
			var fileName = file.name.split('.');
            var suiji = Math.floor(Math.random() * (9999 - 1000)) + 1000;
            //è·å–ä¸ƒç‰›token  å…·ä½“çœ‹é¡¹ç›®æœ¬èº«ä¸Šä¼ é€»è¾‘
			return qiniuToken({
				type: 2  //1å›¾ç‰‡ 2è§†é¢‘ 
			}).then(data => {
				this.uploadData.token = data.data;
				this.uploadData.key = 'TB_' + this.$md5(fileName[0] + suiji) + '.' + fileName.pop();
				this.uploadLoading = true;
			});
		},
		onFileProgress(event, file, fileList) {
			this.fileList = fileList
			var self = this
			var uploadTime = (event.timeStamp / 1000).toFixed(2);
			var uploadSize = (event.loaded / 1024).toFixed(2);
			var speed = (uploadSize / uploadTime).toFixed(2);
			var progress = Number.parseInt((event.loaded / event.total).toFixed(2) * 100);
			self.progressNum = progress;
			if (speed > 1000) {
				speed = (speed / 1000).toFixed(2) + 'MB/s';
			} else {
				speed = speed + 'KB/s';
			}
			this.uploadSpeed = speed;
		},
		handleSuccessUpload(response, file, fileList) {
            // ä¸Šä¼ æˆåŠŸåæ‰§è¡Œçš„æ“ä½œ
            var videoLink = "è§†é¢‘åœ°å€"
            var video = '<video src='+videoLink + 'controls="controls" width="100%"></video>'
            //è¿™é‡Œæ ¹æ®éœ€æ±‚è®¾ç½®è§†é¢‘æ ·å¼
            editor.txt.append(`<p><video src=${videoLink} controls="controls" style='width:100%;height:400px'></video><br></p>`);
            //å˜æ›´åæ”¹å˜çˆ¶ç»„ä»¶
            this.$emit('on-change', editor.txt.html());
			
		},
        */
		setCurrentValue(value) {
			if (value === this.currentValue) return;
			editor.txt.html(`<p>${value}</p>`);
		}
	},
	mounted() {
		this.createEditor();
	},
	watch: {
		content(val) {
			this.setCurrentValue(val);
		}
	}
};
</script>
<style>
.header{
	position: relative;
}
.upload-demo{
	position: absolute;
	right: 20px;
	top: 10px;
}
.w-e-text-container {
	height: 300px !important;
}
.w-e-toolbar {
	background: transparent !important;
	padding: 10px;
}
.editor {
	border: 1px #ccc solid;
}

#div2 {
	min-height: 500px;
}

</style>

```